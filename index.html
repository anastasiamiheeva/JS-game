<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, user-scalable=no"
  <title>Document</title>
  <style>
     canvas {
      border: 1px solid black;
      width: 100%;
    }
    body {
      padding: 0;
      margin: 0;
      background-color: black;
    }
  </style>
</head>
<body>
  <h1>первый шаг</h1>
  <canvas id="mycanvas" width="640" height="360" ></canvas>
  <script>
    window.addEventListener('load', function() {
       //константы 
      let GAME_WIDTH = 640;
      let GAME_HEIGHT = 360;

      let gameLive = true;
      //враги
      let enemies = [
        {
          x: 100, //x координата
          y: 100, //y координата
          speedY: 1, //скорость по Y
          w: 40, //ширина
          h: 40 //высота
        },
        {
          x: 260,
          y: 100,
          speedY: 2,
          w: 40,
          h: 40
        },
        {
          x: 380,
          y: 100,
          speedY: 1,
          w: 40,
          h: 40
        },
        {
          x: 450,
          y: 100,
          speedY: 7,
          w: 40,
          h: 40
        }
      ];

      //объект игрока
      let player = {
        x: 10,
        y: 160,
        speedX: 2,
        w: 40,
        h: 40,
        isMoving: false
      }

      let movePlayer = function() {
        player.isMoving = true;
      };

      let stopPlayer = function() {
        player.isMoving = false;
      }

      //получаем холст и контекст
      let canvas = document.getElementById("mycanvas");
      let ctx = canvas.getContext("2d");

      //addEventListener на объект игрока
      canvas.addEventListener("mousedown", movePlayer);
      canvas.addEventListener("mouseup", stopPlayer);
      canvas.addEventListener("touchstart", movePlayer);
      canvas.addEventListener("touchend", stopPlayer);

      //логика объектов

      let update = function() {

        //игрок
        if(player.isMoving) {
          player.x = player.x + player.speedX
        }

        //враги
        let i = 0;
        let n = enemies.length;

        enemies.forEach(function(element, index){

          if(chekCollision(player, element)) {
            //остановка игры
            gameLive = false;
            alert("Game OVER");
            //restart
            window.location = ""
          }
          element.y += element.speedY;
          //соприкосновение объектов
          if(element.y <= 10) {
            element.y = 10;
            element.speedY = element.speedY * -1; //element.speedY *= -1
          } 
          else if (element.y >= GAME_HEIGHT - 50) {
            element.y = GAME_HEIGHT - 50;
            element.speedY = element.speedY * -1;
          }
        });
      };

      //показать объекты на экране
      let draw = function() {
        //чистим холст
        ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
       
        //объект игрока
        ctx.fillStyle = "#00FF00";
          ctx.fillRect(player.x, player.y, player.w, player.h);

        //объекты врагов
        ctx.fillStyle = "#3333FF";
        enemies.forEach(function(element, index) {
          ctx.fillRect(element.x, element.y, element.w, element.h)
        });
      };

      //инициализируем несколько раз в секунду
    let step = function() {

      update();
      draw();
      if(gameLive){
        window.requestAnimationFrame(step);
      }
    };
    let chekCollision = function(rect1, rect2){

      let closeOnWidth= Math.abs(rect1.x - rect2.x) <= Math.abs(rect1.w, rect2.w);
      let closeOnHeight = Math.abs(rect1.y - rect2.y) <= Math.abs(rect1.h, rect2.h);
      return closeOnHeight && closeOnWidth;
    }
    step();
  })
   
  </script>
</body>
</html>